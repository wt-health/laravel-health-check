name: 'Test CI'
on:
  workflow_dispatch:
  pull_request:

jobs:
  lint:
    timeout-minutes: 20
    runs-on: ubuntu-latest
    needs: composer
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 8.3
          extensions: dom, bcmath, curl, libxml, gettext, exif, iconv, intl, mbstring, gd, imagick, soap, sockets, zip, pcntl, pdo, mysql, pdo_mysql
          coverage: pcov
      - name: Composer Install
        run: composer install
      - name: PHP Coding Standards
        run: composer pint

  test:
    timeout-minutes: 20
    runs-on: ubuntu-latest
    needs: composer
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 8.3
          extensions: dom, bcmath, curl, libxml, gettext, exif, iconv, intl, mbstring, gd, imagick, soap, sockets, zip, pcntl, pdo, mysql, pdo_mysql
          coverage: pcov
      - name: Composer Install
        run: composer install
      - name: PHP Coding Standards
        run: composer test
